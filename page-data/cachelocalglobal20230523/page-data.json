{
    "componentChunkName": "component---src-templates-post-template-jsx",
    "path": "/cachelocalglobal20230523/",
    "result": {"data":{"markdownRemark":{"html":"<p>줌인터넷을 다니면서 여러 서비스를 오픈했다. 서빙하는 과정에서 캐싱은 중요하다. 클라이언트 개발자에게도 좋은 퍼포먼스를 내기위해 중요하며 서비스를 사용하는 사용자에게도 어플리케이션의 좋은 성능을 경험시켜주기 위해 서빙 속도는 중요하다. 줌투자(PC)와 인베스팅뷰(APP) 은 금융에 대한 서비스다. 캐싱에 대한 처리는 당연히 했으며 해당 부분을 포스팅하려고 한다.</p>\n<h2 id=\"가보자고---로컬-캐시\" style=\"position:relative;\"><a href=\"#%EA%B0%80%EB%B3%B4%EC%9E%90%EA%B3%A0---%EB%A1%9C%EC%BB%AC-%EC%BA%90%EC%8B%9C\" aria-label=\"가보자고   로컬 캐시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>가보자고 - 로컬 캐시</h2>\n<p>Local 하게 캐싱을 해야할 때,</p>\n<p>정답은 없다. 하지만 보편적으로 지역적으로 캐싱을 해야할 때는 동기화에 문제가 없는 경우에 로컬 캐싱을 한다. 예를 들어, 내가 서비스를 하고 있는 줌투자, 인베스팅뷰를 예를 들겠다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.484848484848484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEklEQVQY05WQO0vEQBSF8zv9C2snFlqIlQv2giKChTZaWYmgFq6FsJWQxZjH5mFYEpPNw6gxIcknmWy0UAsvfJw7F+acmStNHhSapvkX0Gld19R1s6AWM2k6NZnP58RxLDQMQ6IoEtrO0jQVfZIkQn3f5yXLCIOA30rKsoyiKMjzfJH+s7qXdFRVBU3D63uOrD/xaD+jOCET3SJ7y5E0TaNFlmVM08S2bXRdFzPLskTfhvVmwhAI45Th/gmHZzccX9yxtXuE5fpI7QXDMFBVVdCbtbRnRVFEiOu6OI4j8DyP2WzGYHWD5bVN1ofbLA1WGN/LSGVZfqV+L/3vL/fL/yhLTkdj9s6vObi6ZedyhO4HfAI6Z762BvuSPAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"     2023 11 22    6 53 16\" title=\"     2023 11 22    6 53 16\" src=\"/static/d0cc744d50e522e0532f76bf5d492820/7c811/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.16.png\" srcset=\"/static/d0cc744d50e522e0532f76bf5d492820/103f2/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.16.png 165w,\n/static/d0cc744d50e522e0532f76bf5d492820/748ba/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.16.png 330w,\n/static/d0cc744d50e522e0532f76bf5d492820/7c811/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.16.png 660w,\n/static/d0cc744d50e522e0532f76bf5d492820/d28e0/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.16.png 990w,\n/static/d0cc744d50e522e0532f76bf5d492820/bb51b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.16.png 1320w,\n/static/d0cc744d50e522e0532f76bf5d492820/e97a1/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.16.png 1966w\" sizes=\"(max-width: 660px) 100vw, 660px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>위와 같이 투자노트라든지 또 뉴스와 같은 콘텐츠 기반의 데이터 서빙은 글로벌하게 캐싱을 하지 않아도 된다. 왜? 사용자 입장에서 콘텐츠와 같은 부분은 크게 동기화 이슈 지장이 없기 때문이다. 가령, 1초의 간격으로 A라는 사람은 새로운 투자노트를 보게 될수도 B라는 사람은 못보게 될수도 있다. 다만, 그 1초에 큰 의의를 두지 않는다.</p>\n<p>좀 더 요약하자면 애플리케이션의 각 인스턴스가 자체적인 캐시를 유지하며, 다른 인스턴스와 캐시를 공유하지 않는 경우에 적합하다. 그래서 제한 적인 부분이 <strong>스케일 아웃</strong>에 대한 제한이 있다. 애플리케이션이 여러 서버에 분산될 경우, 각 서버의 캐시는 독립적이므로 캐시 데이터의 일관성을 유지하기 어렵다.</p>\n<p>물론, 특수한 경우가 있을 수 있다. 콘텐츠 기반의 데이터라 해도 동기화에 중요한 콘텐츠라면 로컬 캐시를 쓰면 안된다. 자, 이제 코드를 보자.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 583px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.93939393939393%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABbElEQVQoz41Sy06DUBTk/7/DuHFjYuLGjdH4iCsXxtoCbaFQCrSltLwKhTFz8BKsbeJNJudyXnfOHLS6rqHQNA0Oh0MHfvfjhPIfx+ivqgqaZVmwbRu00+lU7gwmSQLTNGFbtvgY8zwP2+0W4/G4y1V1aZpKYy2KIgwGA4xGI0lcrVZdw8ViITHDMATr9VoaMod+XdcxHA7h+z6yLGsbsnC5XMpr8/lcisqyFKimjG02Gyki4jgWVq7rSj6/i6IQIhq78igdSH2324lVWvLOk+e5PKLGo448Sk/RsL+E/mLYlKw4XhAEoDRkkhdFm/NDoF8rDPvOfpCjOo4jok8mExnPmc2QZWnLrKnRHDU9yVDdwzAUsRWCwIc9c2E4EUwvheWnSLLiV81ZhgRF3u/3At75+su7icubJ1zdPuPi+gH3b18U8DzDY7bdT8vFNQ1MN8bdqy64ffzEh+HJUv418t8HWhslJcK4Enuq5hsNCEyp1QWYggAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"     2023 11 22    6 53 58\" title=\"     2023 11 22    6 53 58\" src=\"/static/6213bb39adf3d4cc9b4515d406ce0394/6d62d/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.58.png\" srcset=\"/static/6213bb39adf3d4cc9b4515d406ce0394/103f2/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.58.png 165w,\n/static/6213bb39adf3d4cc9b4515d406ce0394/748ba/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.58.png 330w,\n/static/6213bb39adf3d4cc9b4515d406ce0394/6d62d/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.58.png 583w\" sizes=\"(max-width: 583px) 100vw, 583px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>모듈화와 재사용성에 용이하도록 구현이 된 코드이다.</p>\n<ol>\n<li><strong>코드 분리</strong>: 캐시 구성을 각각의 독립적인 모듈(인터페이스)로 분리함으로써, 각 캐시 설정의 관리가 편해진다.</li>\n<li><strong>재사용성</strong>: 동일한 유형의 캐시 구성이 다른 곳에서 필요할 경우, 해당 인터페이스를 구현함으로써 재사용에 용이하다.</li>\n<li><strong>확장성</strong>: 새로운 캐시 유형이 필요한 경우, 새로운 인터페이스를 추가하고 기존 클래스에 구현추가만 하면 되므로 확장에 용이하다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@EnableCaching</span><span class=\"token punctuation\">(</span>proxyTargetClass <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EhCacheCachingManagerConfig</span> <span class=\"token keyword\">implements</span> \n        <span class=\"token class-name\">CachingConfigurer</span><span class=\"token punctuation\">,</span>\n        <span class=\"token class-name\">MarketEhcacheConfig</span><span class=\"token punctuation\">,</span>\n        <span class=\"token class-name\">NewsEhcacheConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// 모듈 캐시 기본 설정</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Boolean</span> moduleCacheCacheEternal <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> moduleCacheEvictionPolicy <span class=\"token operator\">=</span> <span class=\"token string\">\"LFU\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> moduleCacheMaxEntriesLocalHeap <span class=\"token operator\">=</span> <span class=\"token number\">500L</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * 캐시 등록\n     * @return CacheManager\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"ehCacheSettingManager\"</span><span class=\"token punctuation\">,</span> destroyMethod <span class=\"token operator\">=</span> <span class=\"token string\">\"shutdown\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\"><span class=\"token namespace\">net<span class=\"token punctuation\">.</span>sf<span class=\"token punctuation\">.</span>ehcache<span class=\"token punctuation\">.</span></span>CacheManager</span> <span class=\"token function\">ehCacheManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token namespace\">net<span class=\"token punctuation\">.</span>sf<span class=\"token punctuation\">.</span>ehcache<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span></span>Configuration</span> config <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token namespace\">net<span class=\"token punctuation\">.</span>sf<span class=\"token punctuation\">.</span>ehcache<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span></span>Configuration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">addMarketCache</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">addNewsCache</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\"><span class=\"token namespace\">net<span class=\"token punctuation\">.</span>sf<span class=\"token punctuation\">.</span>ehcache<span class=\"token punctuation\">.</span></span>CacheManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">newInstance</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token class-name\">CacheManagerType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EHCACHE</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cache<span class=\"token punctuation\">.</span></span>CacheManager</span> <span class=\"token function\">cacheManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EhCacheCacheManager</span><span class=\"token punctuation\">(</span><span class=\"token function\">ehCacheManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CacheResolver</span> <span class=\"token function\">cacheResolver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleCacheResolver</span><span class=\"token punctuation\">(</span><span class=\"token function\">cacheManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">KeyGenerator</span> <span class=\"token function\">keyGenerator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleKeyGenerator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CacheErrorHandler</span> <span class=\"token function\">errorHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleCacheErrorHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 모듈 캐시 기본 설정을 적용하는 메소드\n     * @param name 캐시명\n     * @return CacheConfiguration\n     */</span>\n    <span class=\"token keyword\">static</span> <span class=\"token class-name\">CacheConfiguration</span> <span class=\"token function\">getDefaultModuleCacheConfiguration</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">CacheConfiguration</span> cacheConfiguration <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CacheConfiguration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        cacheConfiguration<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        cacheConfiguration<span class=\"token punctuation\">.</span><span class=\"token function\">setEternal</span><span class=\"token punctuation\">(</span>moduleCacheCacheEternal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        cacheConfiguration<span class=\"token punctuation\">.</span><span class=\"token function\">setMemoryStoreEvictionPolicy</span><span class=\"token punctuation\">(</span>moduleCacheEvictionPolicy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        cacheConfiguration<span class=\"token punctuation\">.</span><span class=\"token function\">setMaxEntriesLocalHeap</span><span class=\"token punctuation\">(</span>moduleCacheMaxEntriesLocalHeap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> cacheConfiguration<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">NewsEhcacheConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">String</span> <span class=\"token constant\">CE_NEWS</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"NEWS:CACHE:\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">String</span> <span class=\"token constant\">CE_LATEST_TOP_NEWS</span> <span class=\"token operator\">=</span> <span class=\"token constant\">CE_NEWS</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"LATEST:TOP_NEWS\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> <span class=\"token constant\">CE_LATEST_TOP_NEWS_</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"'\"</span> <span class=\"token operator\">+</span> <span class=\"token constant\">CE_LATEST_TOP_NEWS</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"'\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Integer</span> <span class=\"token constant\">CE_LATEST_TOP_NEWS_TTL</span> <span class=\"token operator\">=</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">default</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addNewsCache</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\"><span class=\"token namespace\">net<span class=\"token punctuation\">.</span>sf<span class=\"token punctuation\">.</span>ehcache<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span></span>Configuration</span> config<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        config<span class=\"token punctuation\">.</span><span class=\"token function\">addCache</span><span class=\"token punctuation\">(</span><span class=\"token function\">latestTopNewsCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">CacheConfiguration</span> <span class=\"token function\">latestTopNewsCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">CacheConfiguration</span> configuration <span class=\"token operator\">=</span> <span class=\"token class-name\">EhCacheCachingManagerConfig</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDefaultModuleCacheConfiguration</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CE_LATEST_TOP_NEWS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        configuration<span class=\"token punctuation\">.</span><span class=\"token function\">setEternal</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        configuration<span class=\"token punctuation\">.</span><span class=\"token function\">setTimeToLiveSeconds</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CE_LATEST_TOP_NEWS_TTL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> configuration<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//</span>\n<span class=\"token annotation punctuation\">@Cacheable</span><span class=\"token punctuation\">(</span>cacheNames <span class=\"token operator\">=</span> <span class=\"token class-name\">NewsEhcacheConfig</span><span class=\"token punctuation\">.</span><span class=\"token constant\">CE_LATEST_TOP_NEWS</span><span class=\"token punctuation\">,</span>\nkey <span class=\"token operator\">=</span> <span class=\"token class-name\">NewsEhcacheConfig</span><span class=\"token punctuation\">.</span><span class=\"token constant\">CE_LATEST_TOP_NEWS_</span><span class=\"token punctuation\">,</span>\nunless <span class=\"token operator\">=</span> <span class=\"token string\">\"#result == null\"</span><span class=\"token punctuation\">,</span>\ncacheManager <span class=\"token operator\">=</span> <span class=\"token class-name\">CacheManagerType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EHCACHE</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">// logic</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 id=\"가보자고---글로벌-캐시\" style=\"position:relative;\"><a href=\"#%EA%B0%80%EB%B3%B4%EC%9E%90%EA%B3%A0---%EA%B8%80%EB%A1%9C%EB%B2%8C-%EC%BA%90%EC%8B%9C\" aria-label=\"가보자고   글로벌 캐시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>가보자고 - 글로벌 캐시</h2>\n<p>Global 하게 캐싱을 해야할 때,</p>\n<p>동기화에 문제가 있는 경우 보통 레디스에 캐싱처리를 한다. 즉, 스케일 아웃할 때 데이터 정합성, 일관성에 문제가 있는 경우 로컬캐시가 아닌 레디스를 이용하여 캐싱처리를 한다.</p>\n<p>인베스팅뷰 같은 경우, 메코차트라든지 여러 종목에 대한 정보같은 경우 각 인스턴스에 다른 데이터가 캐싱되면 안된다. 즉, 동기화에 민감한 도메인이므로 이런 경우 레디스를 이용하여 캐싱을 한다.</p>\n<p>레디스에 해당 key에 대한 value가 있는 경우, 레디스에서 가져오고 만약 없는 경우 DB( I/O ) 에 데이터를 조회해서 레디스에 다시 저장하고 Client에 데이터를 쏴준다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 29.09090909090909%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/ElEQVQY012Ry27DIBBF/f/fVKVddFNl3Uht02RTRTV+xTEYMOBTDa6tKEhHMMNwdWcoUkrEGDMhBJxzG957usEzjpZcN034SuGVwpclvmu3tyvFNE25eJ5nrLWssVDXNWV9pW1bzDjSVwq7f0PtnuhedrjDOzEmYmJBBJumyU6ym66j7/uM1prbbWAw4nTCeY/TGns+YU9H7PcX7nIhxEDSnyR9zB0WIrK2KE5WQWMMSinOPxX9bcBonXPaWsyGw+gr4+8zrnolBrc4lHZl3bcs9o3RMCfm/ziPQvYNGU3AdQfc9YOUIsXjp4joirgOd3ePH7DkI1E0UsrnP8UJ0KS26hynAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"     2023 11 22    6 53 52\" title=\"     2023 11 22    6 53 52\" src=\"/static/365213bb9d9a526f4471338ac9304d88/7c811/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.52.png\" srcset=\"/static/365213bb9d9a526f4471338ac9304d88/103f2/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.52.png 165w,\n/static/365213bb9d9a526f4471338ac9304d88/748ba/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.52.png 330w,\n/static/365213bb9d9a526f4471338ac9304d88/7c811/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.52.png 660w,\n/static/365213bb9d9a526f4471338ac9304d88/bc563/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.52.png 736w\" sizes=\"(max-width: 660px) 100vw, 660px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token annotation punctuation\">@EnableCaching</span><span class=\"token punctuation\">(</span>proxyTargetClass <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedisCachingManagerConfig</span> <span class=\"token keyword\">implements</span> \n\t\t<span class=\"token class-name\">OverseasRedisConfig</span><span class=\"token punctuation\">,</span>\n    <span class=\"token class-name\">StockRedisConfig</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">RedisConnectionFactory</span> redisConnectionFactory<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token class-name\">CacheManagerType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REDIS</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CacheManager</span> <span class=\"token function\">redisCacheManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">RedisCacheConfiguration</span> config <span class=\"token operator\">=</span> <span class=\"token function\">getRedisCacheConfiguration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RedisCacheConfiguration</span><span class=\"token punctuation\">></span></span> configMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">addOverSeasRedisCache</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> configMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">addStockCache</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> configMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">RedisCacheManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span> <span class=\"token comment\">// change search all from keys to scan</span>\n            <span class=\"token class-name\">RedisCacheWriter</span><span class=\"token punctuation\">.</span><span class=\"token function\">nonLockingRedisCacheWriter</span><span class=\"token punctuation\">(</span>\n                redisConnectionFactory<span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">BatchStrategies</span><span class=\"token punctuation\">.</span><span class=\"token function\">scan</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CACHE_BATCH_SIZE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">cacheDefaults</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">withInitialCacheConfigurations</span><span class=\"token punctuation\">(</span>configMap<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RedisCacheConfiguration</span> <span class=\"token function\">getRedisCacheConfiguration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">final</span> <span class=\"token class-name\">ObjectMapper</span> objectMapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        objectMapper<span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SerializationFeature</span><span class=\"token punctuation\">.</span><span class=\"token constant\">WRITE_DATES_AS_TIMESTAMPS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        objectMapper<span class=\"token punctuation\">.</span><span class=\"token function\">activateDefaultTypingAsProperty</span><span class=\"token punctuation\">(</span>\n            <span class=\"token class-name\">LaissezFaireSubTypeValidator</span><span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">ObjectMapper<span class=\"token punctuation\">.</span>DefaultTyping</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NON_FINAL</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"@class\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        objectMapper<span class=\"token punctuation\">.</span><span class=\"token function\">registerModules</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">JavaTimeModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Jdk8Module</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">RedisCacheConfiguration</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultCacheConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">disableCachingNullValues</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// null value 의 경우 캐시 X</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">serializeKeysWith</span><span class=\"token punctuation\">(</span>\n                <span class=\"token class-name\">RedisSerializationContext\n                    <span class=\"token punctuation\">.</span>SerializationPair</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">fromSerializer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">serializeValuesWith</span><span class=\"token punctuation\">(</span>\n                <span class=\"token class-name\">RedisSerializationContext\n                    <span class=\"token punctuation\">.</span>SerializationPair</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">fromSerializer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">GenericJackson2JsonRedisSerializer</span><span class=\"token punctuation\">(</span>objectMapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">disableKeyPrefix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"overSeasCacheKeyGenerator\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">KeyGenerator</span> <span class=\"token function\">overSeasCacheKeyGenerator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OverSeasRedisKeyGenerator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// </span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">StockRedisConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">String</span> <span class=\"token constant\">CE_STOCK</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"STOCK:CACHE:\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">String</span> <span class=\"token constant\">CE_STOCK_RELATED</span> <span class=\"token operator\">=</span> <span class=\"token constant\">CE_STOCK</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"RELATED\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> <span class=\"token constant\">CE_STOCK_RELATED_</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"'\"</span> <span class=\"token operator\">+</span> <span class=\"token constant\">CE_STOCK_RELATED</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"'\"</span> <span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Integer</span> <span class=\"token constant\">CE_STOCK_STATEMENTS_TTL</span> <span class=\"token operator\">=</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">24</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 하루</span>\n\n    <span class=\"token keyword\">default</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addStockCache</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisCacheConfiguration</span> config<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RedisCacheConfiguration</span><span class=\"token punctuation\">></span></span> map<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">allStocksStatements</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">stockRelated</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">allStocksStatements</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisCacheConfiguration</span> config<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RedisCacheConfiguration</span><span class=\"token punctuation\">></span></span> configMap<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        configMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CE_STOCK_STATEMENTS</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        configMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CE_STOCK_STATEMENTS</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span><span class=\"token function\">entryTtl</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Duration</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofSeconds</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CE_STOCK_STATEMENTS_TTL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>로컬캐시인 ehcache 와 같은 로직이다. 설정에 대한 부분은 RedisCachingManagerConfig 에 설정을 해놓고 해당 데이터에 대한 키값 설정과 TTL 은 인터페이스를 이용해서 구현한다.</p>\n<p>인베스팅뷰와 줌투자 같은 경우, 데이터파이프 라인을 이용하여 레디스에 데이터를 적재하고 그 레디스를 인베스팅뷰, 줌투자 각각 동일한 데이터로 서빙을 한다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 29.09090909090909%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDUlEQVQY012R207DMBBE8//fAzwioQrEM0W80ObWJkRtMU7s1I4vGTRGBolIo81uNGcvKZxzmKWEEALzPMN7D2MMlsXCWAurNUYpMU0TrLXpG2MIAeu6/irGmGqFUgpKiATUWicja8uy4GoMjrt3NFWJsqpwPp+TidCscRyTOAyhBQF8mLATQQRKTqU0PsoSbV2jadtU49Q0E8K873t0XZfe6S+4YgwhdSaUQHZmbq3B0NQ4DT2GoYeaRsTIk1zTaSieLCtNmHfPQEbvI5wRkMcHiMMG1esd9tsb7Le3+Gzu4c0JIf5s9V9FhmVgTBGIboKXLwjTGy6HZwzVI7rdBpf2CdF9IUT+iD9v9n8DI/rNzygftLQAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"     2023 11 22    6 53 30\" title=\"     2023 11 22    6 53 30\" src=\"/static/1d219a91d8db43c0d9993c5cf8e3009f/7c811/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.30.png\" srcset=\"/static/1d219a91d8db43c0d9993c5cf8e3009f/103f2/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.30.png 165w,\n/static/1d219a91d8db43c0d9993c5cf8e3009f/748ba/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.30.png 330w,\n/static/1d219a91d8db43c0d9993c5cf8e3009f/7c811/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.30.png 660w,\n/static/1d219a91d8db43c0d9993c5cf8e3009f/8aec5/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.30.png 942w\" sizes=\"(max-width: 660px) 100vw, 660px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">FinanceRealTimeStockResponse</span> <span class=\"token function\">getRealTimeStock</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> stockCode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token class-name\">HashOperations</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> hashOperations <span class=\"token operator\">=</span> financeRedisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForHash</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StockStandardCode</span><span class=\"token punctuation\">></span></span> optionalStockStandardCode <span class=\"token operator\">=</span> <span class=\"token function\">getStockStandardCode</span><span class=\"token punctuation\">(</span>stockCode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token class-name\">String</span> standardCode <span class=\"token operator\">=</span> optionalStockStandardCode\n          <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IllegalArgumentException</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">getStandardCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> entries <span class=\"token operator\">=</span> hashOperations<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StockRedisKey<span class=\"token punctuation\">.</span>StockKey</span><span class=\"token punctuation\">(</span>standardCode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t\t<span class=\"token comment\">// stock, stockTrading, stockIndicator</span>\n      <span class=\"token class-name\">AStock</span> aStock <span class=\"token operator\">=</span> objectMapper<span class=\"token punctuation\">.</span><span class=\"token function\">convertValue</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StockRedisKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STOCK_HASH_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Stock</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token class-name\">AStockTrading</span> aStockTrading <span class=\"token operator\">=</span> objectMapper<span class=\"token punctuation\">.</span><span class=\"token function\">convertValue</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StockRedisKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STOCK_TRADING_HASH_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">StockTrading</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token class-name\">AStockIndicator</span> aStockIndicator <span class=\"token operator\">=</span> objectMapper<span class=\"token punctuation\">.</span><span class=\"token function\">convertValue</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StockRedisKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STOCK_INDICATOR_HASH_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">StockIndicator</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token class-name\">AStockResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Stock</span><span class=\"token punctuation\">,</span> aStockTrading<span class=\"token punctuation\">,</span> aStockIndicator<span class=\"token punctuation\">,</span> logoImageUri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getRealTimeStock error :: {}\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AStockResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//</span>\n\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedisConfig</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${spring.redis.host}\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> redisHost<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${spring.redis.port}\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> redisPort<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@Bean</span>\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">LettuceConnectionFactory</span> <span class=\"token function\">redisConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">RedisStandaloneConfiguration</span> redisStandaloneConfiguration <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RedisStandaloneConfiguration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    redisStandaloneConfiguration<span class=\"token punctuation\">.</span><span class=\"token function\">setHostName</span><span class=\"token punctuation\">(</span>redisHost<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    redisStandaloneConfiguration<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span>redisPort<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LettuceConnectionFactory</span><span class=\"token punctuation\">(</span>redisStandaloneConfiguration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token annotation punctuation\">@Bean</span>\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">ObjectMapper</span> <span class=\"token function\">objectMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">ObjectMapper</span> objectMapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    objectMapper<span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SerializationFeature</span><span class=\"token punctuation\">.</span><span class=\"token constant\">WRITE_DATES_AS_TIMESTAMPS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    objectMapper<span class=\"token punctuation\">.</span><span class=\"token function\">registerModules</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">JavaTimeModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Jdk8Module</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> objectMapper<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ARedisTemplate\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">ARedisTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ObjectMapper</span> objectMapper<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">GenericJackson2JsonRedisSerializer</span> serializer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GenericJackson2JsonRedisSerializer</span><span class=\"token punctuation\">(</span>objectMapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> redisTemplate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token function\">redisConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setKeySerializer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setValueSerializer</span><span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setHashKeySerializer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setHashValueSerializer</span><span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> redisTemplate<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"redisAsyncCommands\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">RedisAsyncCommands</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">redisAsyncCommands</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ObjectMapper</span> objectMapper<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">RedisURI</span> redisURI <span class=\"token operator\">=</span> <span class=\"token class-name\">RedisURI</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>redisHost<span class=\"token punctuation\">,</span> redisPort<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">RedisClient</span> redisClient <span class=\"token operator\">=</span> <span class=\"token class-name\">RedisClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>redisURI<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> redisClient<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringObjectRedisCodec</span><span class=\"token punctuation\">(</span>objectMapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">async</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","timeToRead":6,"excerpt":"줌인터넷을 다니면서 여러 서비스를 오픈했다. 서빙하는 과정에서 캐싱은 중요하다. 클라이언트 개발자에게도 좋은 퍼포먼스를 내기위해 중요하며 서비스를 사용하는 사용자에게도 어플리케이션의 좋은 성능을 경험시켜주기 위해 서빙 속도는 중요하다. 줌투자(PC…","frontmatter":{"title":"[1] 서비스 캐싱 - Local, Global","date":"2023-05-23T22:31:00Z","categories":["spring"],"tags":["spring","java","cache"],"description":"this is a description","keywords":"pig","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/6213bb39adf3d4cc9b4515d406ce0394/7f7a0/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.58.png","srcSet":"/static/6213bb39adf3d4cc9b4515d406ce0394/7f7a0/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.58.png 583w","sizes":"583px"},"sources":[{"srcSet":"/static/6213bb39adf3d4cc9b4515d406ce0394/5d85b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%206.53.58.webp 583w","type":"image/webp","sizes":"583px"}]},"width":660,"height":354}}}},"fields":{"slug":"/cachelocalglobal20230523/","date":"2023-05-23T22:31:00.000Z"}}},"pageContext":{"slug":"/cachelocalglobal20230523/","nexttitle":"객체 지향 설계 5원칙 - SOLID","nextslug":"/solid20220501/","prevtitle":"도커 overlay 용량을 정리해보자.","prevslug":"/docker20231113/","tagList":["docker","spring","java","cache","theory","git","mysql","db"],"categoryList":["docker","spring","theory","java","db"],"latestPostEdges":[{"node":{"fields":{"slug":"/docker20231113/"},"frontmatter":{"template":"post","title":"도커 overlay 용량을 정리해보자.","tags":["docker"],"categories":["docker"],"date":"2023-11-13T22:31:00Z"}}},{"node":{"fields":{"slug":"/cachelocalglobal20230523/"},"frontmatter":{"template":"post","title":"[1] 서비스 캐싱 - Local, Global","tags":["spring","java","cache"],"categories":["spring"],"date":"2023-05-23T22:31:00Z"}}},{"node":{"fields":{"slug":"/solid20220501/"},"frontmatter":{"template":"post","title":"객체 지향 설계 5원칙 - SOLID","tags":["theory"],"categories":["theory"],"date":"2022-05-01T22:31:00Z"}}},{"node":{"fields":{"slug":"/jpa120220421/"},"frontmatter":{"template":"post","title":"JPA 영속성 관리","tags":["java","spring"],"categories":["spring"],"date":"2022-04-21T22:31:00Z"}}},{"node":{"fields":{"slug":"/collector20220303/"},"frontmatter":{"template":"post","title":"Collect, Collector, Collectors 정리","tags":["java"],"categories":["java"],"date":"2022-03-03T22:31:00Z"}}},{"node":{"fields":{"slug":"/gitbasic20220218/"},"frontmatter":{"template":"post","title":"GIT 에 대한 그림 이해","tags":["git"],"categories":["theory"],"date":"2022-02-18T22:31:00Z"}}},{"node":{"fields":{"slug":"/builderdefault20220103/"},"frontmatter":{"template":"post","title":"Builder Pattern - @Builder error : Final, @Builder.default (초기화, @Builder will ignore the initializing expression entirely) ","tags":["spring","java"],"categories":["spring"],"date":"2022-01-03T22:31:00Z"}}},{"node":{"fields":{"slug":"/between20210729/"},"frontmatter":{"template":"post","title":"Mysql Query Between 과 >=, <= 성능 차이 비교 ( 더미데이터 50만 )","tags":["mysql","db"],"categories":["db"],"date":"2021-07-29T20:31:00Z"}}}]}},
    "staticQueryHashes": []}